{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/billing/vouchers/addCredit/cloud-project-billing-vouchers-add-credit-agora.controller.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/billing/vouchers/addCredit/cloud-project-billing-vouchers-add-credit-agora.controller.js","mtime":1539717141962},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["angular.module('managerApp').controller('CloudProjectBillingVouchersAddcreditAgoraCtrl', class CloudProjectBillingVouchersAddcreditAgoraCtrl {\n  constructor($http, $q, $translate, $uibModalInstance, $window, CloudMessage) {\n    this.$http = $http;\n    this.$q = $q;\n    this.$translate = $translate;\n    this.$uibModalInstance = $uibModalInstance;\n    this.$window = $window;\n    this.CloudMessage = CloudMessage;\n    this.orderLimits = {\n      min: 1,\n      max: 20000000,\n    };\n  }\n\n  $onInit() {\n    this.amount = 10;\n    this.loading = true;\n    return this.$http.get('/order/catalog/formatted/cloud', {\n      serviceType: 'apiv6',\n      params: {\n        ovhSubsidiary: 'US',\n      },\n    }).then((result) => {\n      this.price = _.chain(result)\n        .get('data.plans')\n        .filter(p => p.planCode === 'credit' && p.pricingType === 'purchase')\n        .head()\n        .get('details.pricings.default')\n        .filter(p => p.capacities.indexOf('installation') >= 0)\n        .head()\n        .get('price')\n        .value();\n    }).catch((err) => {\n      this.CloudMessage.error([this.$translate.instant('cpb_vouchers_add_credit_load_err'), _.get(err, 'data.message', '')].join(' '));\n      this.$uibModalInstance.dismiss();\n      return this.$q.reject(err);\n    }).finally(() => {\n      this.loading = false;\n    });\n  }\n\n  order() {\n    const order = {\n      planCode: 'credit',\n      productId: 'cloud',\n      pricingMode: 'default',\n      quantity: Math.floor(this.amount / this.price.value),\n      configuration: [{\n        label: 'type',\n        value: 'public_cloud',\n      }],\n    };\n    this.$window.open(`https://us.ovhcloud.com/order/express/#/express/review?products=${JSURL.stringify([order])}`, '_blank');\n    this.$uibModalInstance.dismiss();\n  }\n\n  cancel() {\n    this.$uibModalInstance.dismiss();\n  }\n});\n"]}