{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js??ref--10-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/common/OvhPoll.service.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/common/OvhPoll.service.js","mtime":1539717142057},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/.babelrc","mtime":1539717141926},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar OvhPoll =\n/*#__PURE__*/\nfunction () {\n  OvhPoll.$inject = [\"$q\", \"$interval\"];\n\n  function OvhPoll($q, $interval) {\n    _classCallCheck(this, OvhPoll);\n\n    this.$q = $q;\n    this.$interval = $interval;\n  }\n\n  _createClass(OvhPoll, [{\n    key: \"poll\",\n    value: function poll(opts) {\n      opts = _.extend({}, _.omit(opts, 'item'), {\n        items: [opts.item]\n      }); // eslint-disable-line\n\n      return this.pollArray(opts);\n    } // Polling opts. Contains items to poll, pollFunction callback, stopCondition callback\n    // and interval (optional, default 5000).\n    // Ex =>\n    // {\n    //   item: [1, 2, 3],\n    //   pollFunction: item => doSomething(),\n    //   stopCondition: item => doSomething(),\n    //   interval: 10000,\n    // }\n\n  }, {\n    key: \"pollArray\",\n    value: function pollArray(opts) {\n      var _this = this;\n\n      var poller = {};\n      var items = opts.items;\n\n      _.set(opts, 'onItemDone', opts.onItemDone ? opts.onItemDone : _.noop);\n\n      _.set(opts, 'onItemUpdated', opts.onItemUpdated ? opts.onItemUpdated : _.noop);\n\n      _.set(opts, 'stopCondition', opts.stopCondition ? opts.stopCondition : _.noop);\n\n      var deferred = this.$q.defer();\n      poller.pollInterval = this.$interval(function () {\n        var promises = _.map(items, function (item) {\n          return _this.$q.when(opts.pollFunction(item)).then(function (newItem) {\n            if (newItem) {\n              var newItemKeys = _.keys(newItem);\n\n              _.forEach(_.keys(item), function (key) {\n                if (!_.includes(newItemKeys, key)) {\n                  delete item[key]; // eslint-disable-line\n                }\n              });\n\n              _.merge(item, newItem.data ? newItem.data : newItem);\n\n              opts.onItemUpdated(item);\n            }\n\n            return _this.$q.when(opts.stopCondition(item));\n          }).catch(function () {\n            // If an error is encountered, we end the polling.\n            item = null; // eslint-disable-line\n\n            return true;\n          }).then(function (stopCondition) {\n            if (stopCondition) {\n              opts.onItemDone(item);\n            }\n\n            return {\n              stopping: stopCondition,\n              item: item\n            };\n          });\n        });\n\n        _this.$q.all(promises).then(function (results) {\n          items = _.map(_.filter(results, function (result) {\n            return !result.stopping;\n          }), function (result) {\n            return result.item;\n          });\n\n          if (!items.length) {\n            poller.kill();\n            deferred.resolve(results);\n          }\n        });\n      }, opts.interval || 5000);\n\n      poller.kill = function () {\n        _this.$interval.cancel(poller.pollInterval);\n      };\n\n      poller.$promise = deferred.promise;\n      return poller;\n    }\n  }]);\n\n  return OvhPoll;\n}();\n\nangular.module('managerApp').service('OvhPoll', OvhPoll);",null]}