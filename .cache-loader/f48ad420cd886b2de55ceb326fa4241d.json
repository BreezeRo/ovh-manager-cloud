{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js??ref--10-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/infrastructure/ip/failover/buy/cloud-project-compute-infrastructure-ip-failover-buy-agora.controller.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/infrastructure/ip/failover/buy/cloud-project-compute-infrastructure-ip-failover-buy-agora.controller.js","mtime":1539717141982},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/.babelrc","mtime":1539717141926},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["angular.module('managerApp').controller('CloudProjectComputeInfrastructureIpFailoverBuyAgoraCtrl', [\"$http\", \"$q\", \"$stateParams\", \"$translate\", \"$uibModalInstance\", \"$window\", \"CloudMessage\", \"OvhApiCloudProjectInstance\", function ($http, $q, $stateParams, $translate, $uibModalInstance, $window, CloudMessage, OvhApiCloudProjectInstance) {\n  var self = this;\n\n  function getIpfoCatalog() {\n    return $http.get('/order/catalog/formatted/ip', {\n      serviceType: 'apiv6',\n      params: {\n        ovhSubsidiary: 'US'\n      }\n    }).then(function (result) {\n      if (result.status !== 200) {\n        return $q.reject(result);\n      }\n\n      return _.filter(_.get(result, 'data.plans'), function (offer) {\n        return /failover/.test(offer.planCode);\n      });\n    });\n  }\n\n  function init() {\n    self.loading = true;\n    self.product = null;\n    self.quantity = 1;\n    self.country = null;\n    self.instance = null;\n    return $q.all({\n      catalog: getIpfoCatalog(),\n      instances: OvhApiCloudProjectInstance.v6().query({\n        serviceName: $stateParams.projectId\n      })\n    }).then(function (_ref) {\n      var catalog = _ref.catalog,\n          instances = _ref.instances;\n      self.instances = instances;\n      self.catalog = catalog;\n      self.product = _.first(catalog);\n      self.country = _.first(self.getCountries(self.product));\n      self.instance = _.first(self.instances);\n    }).catch(function (err) {\n      CloudMessage.error([$translate.instant('cpciif_buy_init_error'), err.data && err.data.message || ''].join(' '));\n      $uibModalInstance.dismiss();\n      return $q.reject(err);\n    }).finally(function () {\n      self.loading = false;\n    });\n  }\n\n  self.getPrice = function (product) {\n    return _.chain(product).get('details.pricings.default').filter(function (p) {\n      return p.capacities.indexOf('installation') >= 0;\n    }).first().get('price').value();\n  };\n\n  self.getCountries = function (product) {\n    return _.chain(product).get('details.product.configurations').find({\n      name: 'country'\n    }).get('values').value();\n  };\n\n  self.getMaximumQuantity = function (product) {\n    return _.chain(product).get('details.pricings.default').filter(function (p) {\n      return angular.isNumber(p.maximumQuantity);\n    }, 'maximumQuantity').min('maximumQuantity').get('maximumQuantity').value();\n  };\n\n  self.order = function () {\n    var order = {\n      planCode: self.product.planCode,\n      productId: 'ip',\n      pricingMode: 'default',\n      quantity: self.quantity,\n      configuration: [{\n        label: 'country',\n        value: self.country\n      }, {\n        label: 'destination',\n        value: $stateParams.projectId\n      }, {\n        label: 'nexthop',\n        value: self.instance.id\n      }]\n    };\n    $window.open(\"https://us.ovhcloud.com/order/express/#/express/review?products=\".concat(JSURL.stringify([order])), '_blank');\n    $uibModalInstance.dismiss();\n  };\n\n  self.cancel = $uibModalInstance.dismiss;\n  init();\n}]);",null]}