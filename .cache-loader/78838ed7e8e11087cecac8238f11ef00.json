{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js??ref--10-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/quota/cloud-project-compute-quota.controller.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/quota/cloud-project-compute-quota.controller.js","mtime":1539717142030},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/.babelrc","mtime":1539717141926},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["angular.module('managerApp').controller('CloudProjectComputeQuotaCtrl', [\"$q\", \"$stateParams\", \"$translate\", \"REDIRECT_URLS\", \"OvhApiCloudProject\", \"OvhApiCloudProjectQuota\", \"OvhApiMe\", \"CloudMessage\", \"OtrsPopupService\", \"RegionService\", \"TARGET\", function CloudProjectComputeQuotaCtrl($q, $stateParams, $translate, REDIRECT_URLS, OvhApiCloudProject, OvhApiCloudProjectQuota, OvhApiMe, CloudMessage, OtrsPopupService, RegionService, TARGET) {\n  // ---------VARIABLE DECLARATION---------\n  var self = this;\n  var serviceName = $stateParams.projectId;\n  this.loader = {\n    quota: false,\n    unleash: false\n  };\n  this.datas = {\n    quota: null,\n    defaultPaymentMean: null\n  };\n  this.state = {\n    isRestrictedQuota: false\n  }; // PaymentMean URL (v6 dedicated) with sessionv6\n\n  this.paymentmeanUrl = REDIRECT_URLS.paymentMeans;\n  this.supportUrl = REDIRECT_URLS.support;\n  self.regionService = RegionService;\n  this.TARGET = TARGET; // ---------SUPPORT---------\n\n  this.openSupport = function openSupport() {\n    if (!OtrsPopupService.isLoaded()) {\n      OtrsPopupService.init();\n    } else {\n      OtrsPopupService.toggle();\n    }\n  }; // ---------UNLEASH---------\n\n\n  function initPaymentMethods() {\n    if (self.TARGET !== 'US') {\n      return OvhApiMe.PaymentMean().v6().getDefaultPaymentMean();\n    }\n\n    return OvhApiMe.PaymentMethod().v6().query({\n      status: 'VALID'\n    }).$promise.then(function (paymentMethodIds) {\n      return _.map(paymentMethodIds, function (paymentMethodId) {\n        return $q.all(OvhApiMe.PaymentMethod().v6().get({\n          id: paymentMethodId\n        }).$promise);\n      });\n    }).then(function (paymentMethods) {\n      return _.find(paymentMethods, {\n        default: true\n      });\n    });\n  }\n\n  function init() {\n    var initQueue = [];\n    self.loader.quota = true;\n    self.loader.unleash = false; // check default payment mean\n\n    initQueue.push(initPaymentMethods().then(function (defaultPaymentMean) {\n      self.datas.defaultPaymentMean = defaultPaymentMean;\n    })); // get quota\n\n    initQueue.push(OvhApiCloudProjectQuota.v6().query({\n      serviceName: serviceName\n    }).$promise.then(function (quotas) {\n      self.datas.quota = quotas;\n    }));\n    return $q.all(initQueue).then(function () {\n      // check if quota is restricted\n      if (self.datas.quota.length) {\n        self.state.isRestrictedQuota = self.datas.quota[0].maxInstances === 1 && self.datas.quota[0].maxCores === 1 && self.datas.quota[0].maxRam === 2048;\n      }\n    }, function (err) {\n      CloudMessage.error([$translate.instant('cpb_quota_loading_error'), err.data && err.data.message || ''].join(' '));\n      self.datas.quota = null;\n    }).finally(function () {\n      self.loader.quota = false;\n    });\n  }\n\n  this.unleashAccount = function unleashAccount() {\n    self.loader.unleash = true;\n    return OvhApiCloudProject.v6().unleash({\n      serviceName: serviceName\n    }, {}).$promise.then(function () {\n      init();\n    }, function (err) {\n      if (err.status === 403) {\n        CloudMessage.error($translate.instant('cpb_quota_already_unleashed'));\n      } else {\n        CloudMessage.error($translate.instant('cpb_quota_unleash_error'));\n      }\n\n      init();\n    }).finally(function () {\n      self.loader.unleash = false;\n    });\n  }; // ---------INITIALIZATION---------\n\n\n  init();\n}]);",null]}