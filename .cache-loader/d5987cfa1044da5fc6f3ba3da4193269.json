{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/veeam/storage/veeam-storage.controller.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/veeam/storage/veeam-storage.controller.js","mtime":1539717142283},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["(() => {\n  class VeeamStorageCtrl {\n    constructor($stateParams, $translate, ControllerHelper, RegionService, VeeamService) {\n      this.$stateParams = $stateParams;\n      this.$translate = $translate;\n      this.ControllerHelper = ControllerHelper;\n      this.RegionService = RegionService;\n      this.VeeamService = VeeamService;\n\n      this.storageInfos = ControllerHelper.request.getArrayLoader({\n        loaderFunction: () => this.VeeamService.getStorages(this.$stateParams.serviceName),\n        errorHandler: response => this.VeeamService.unitOfWork.messages.push({\n          text: response.message,\n          type: 'error',\n        }),\n      });\n\n      this.actions = this.ControllerHelper.request.getArrayLoader({\n        loaderFunction: () => this.VeeamService.getActions(this.$stateParams.serviceName),\n      });\n\n      this.capabilities = this.ControllerHelper.request.getHashLoader({\n        loaderFunction: () => this.VeeamService.getCapabilities(this.$stateParams.serviceName),\n      });\n    }\n\n    getRegionText(region) {\n      return this.RegionService.getTranslatedMicroRegion(region.toUpperCase());\n    }\n\n    addStorage() {\n      if (this.actions.data.addStorage.available) {\n        this.ControllerHelper.modal.showModal({\n          modalConfig: {\n            templateUrl: 'app/veeam/storage/add/veeam-storage-add.html',\n            controller: 'VeeamStorageAddCtrl',\n            controllerAs: 'VeeamStorageAddCtrl',\n            resolve: {\n              serviceName: () => this.$stateParams.serviceName,\n            },\n          },\n        })\n          .then((result) => {\n            this.VeeamService.startPolling(this.$stateParams.serviceName, result.data)\n              .then(this.storageInfos.load.bind(this));\n          })\n          .catch(err => this.VeeamService.unitOfWork.messages.push({\n            text: err.message,\n            type: 'error',\n          }));\n      } else {\n        this.ControllerHelper.modal.showWarningModal({\n          title: this.$translate.instant('common_action_unavailable'),\n          message: this.actions.data.addStorage.reason,\n        });\n      }\n    }\n\n    updateQuota(inventoryName) {\n      this.ControllerHelper.modal.showModal({\n        modalConfig: {\n          templateUrl: 'app/veeam/storage/update-quota/veeam-storage-update-quota.html',\n          controller: 'VeeamStorageUpdateQuotaCtrl',\n          controllerAs: 'VeeamStorageUpdateQuotaCtrl',\n          resolve: {\n            inventoryName: () => inventoryName,\n            serviceName: () => this.$stateParams.serviceName,\n          },\n        },\n      })\n        .then((result) => {\n          this.VeeamService.startPolling(this.$stateParams.serviceName, result.data)\n            .then(this.storageInfos.load.bind(this));\n        });\n    }\n\n    $onInit() {\n      this.storageInfos.load();\n      this.actions.load();\n      this.capabilities.load();\n    }\n  }\n\n  angular.module('managerApp').controller('VeeamStorageCtrl', VeeamStorageCtrl);\n})();\n"]}