{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/openstack/users/token/openstack-users-token.controller.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/openstack/users/token/openstack-users-token.controller.js","mtime":1539717142049},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["angular.module('managerApp')\n  .controller('CloudProjectOpenstackUsersTokenCtrl', function CloudProjectOpenstackUsersTokenCtrl(\n    $q, $uibModalInstance, $stateParams, CloudMessage, $translate, OvhApiCloudProjectUser,\n    openstackUser, OpenstackUsersToken, URLS, OvhApiMe,\n  ) {\n    const self = this;\n\n    self.openstackUser = openstackUser;\n    self.projectId = $stateParams.projectId;\n    self.tokenGuide = {\n      lang: null,\n      link: null,\n    };\n\n    self.generateToken = {\n      password: null,\n      tokens: null,\n    };\n    self.loaders = {\n      generateToken: false,\n    };\n\n    function init() {\n      self.generateToken.tokens = OpenstackUsersToken.get(self.projectId, self.openstackUser.id);\n    }\n\n    // returns openstack token guide depending on current choosen language\n    function getTokenGuideUrl() {\n      const urls = URLS.guides.xauthtoken;\n      return urls[self.tokenGuide.lang.toUpperCase()];\n    }\n\n    self.generate = function () {\n      if (!self.loaders.generateToken) {\n        self.loaders.generateToken = true;\n        return $q.allSettled([\n          OvhApiCloudProjectUser.v6().token({\n            serviceName: self.projectId,\n            userId: self.openstackUser.id,\n          }, {\n            password: self.generateToken.password,\n          }).$promise.then((openstackToken) => {\n            OpenstackUsersToken.put(self.projectId, self.openstackUser.id, openstackToken);\n            self.generateToken.tokens = openstackToken;\n          }, (err) => {\n            CloudMessage.error([$translate.instant('cpou_token_error'), (err.data && err.data.message) || ''].join(' '));\n          }),\n          OvhApiMe.v6().get().$promise.then((me) => {\n            // set guide lang\n            self.tokenGuide.lang = me.ovhSubsidiary;\n            self.tokenGuide.link = getTokenGuideUrl();\n          }),\n        ]).finally(() => {\n          self.loaders.generateToken = false;\n        });\n      }\n      return null;\n    };\n\n    self.close = function () {\n      $uibModalInstance.close();\n    };\n\n    self.cancel = function () {\n      $uibModalInstance.dismiss();\n    };\n\n    init();\n  });\n"]}