{"remainingRequest":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js??ref--10-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js??ref--11-1!/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/infrastructure/privateNetwork/cloud-project-compute-infrastructure-privateNetwork.service.js","dependencies":[{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/client/app/cloud/project/compute/infrastructure/privateNetwork/cloud-project-compute-infrastructure-privateNetwork.service.js","mtime":1539717141992},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/.babelrc","mtime":1539717141926},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/babel-loader/lib/index.js","mtime":1539597349061},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/cache-loader/dist/cjs.js","mtime":1539679504371},{"path":"/Users/jleveugle/Documents/Work/github/ovh-ux/ovh-manager-cloud/node_modules/@ovh-ux/manager-webpack-config/loaders/ui-router-translations.js","mtime":1539950864368}],"contextDependencies":[],"result":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar CloudProjectComputeInfrastructurePrivateNetworkService =\n/*#__PURE__*/\nfunction () {\n  CloudProjectComputeInfrastructurePrivateNetworkService.$inject = [\"$q\", \"$timeout\", \"$translate\", \"CloudMessage\", \"URLS\", \"OvhApiMe\", \"OvhApiCloudProjectRegion\", \"OvhApiCloudProjectNetworkPrivate\", \"OvhApiCloudProjectNetworkPrivateSubnet\"];\n\n  function CloudProjectComputeInfrastructurePrivateNetworkService($q, $timeout, $translate, CloudMessage, URLS, OvhApiMe, OvhApiCloudProjectRegion, OvhApiCloudProjectNetworkPrivate, OvhApiCloudProjectNetworkPrivateSubnet) {\n    _classCallCheck(this, CloudProjectComputeInfrastructurePrivateNetworkService);\n\n    this.$q = $q;\n    this.$timeout = $timeout;\n    this.$translate = $translate;\n    this.CloudMessage = CloudMessage;\n    this.URLS = URLS;\n    this.User = OvhApiMe;\n    this.Region = OvhApiCloudProjectRegion;\n    this.OvhApiCloudProjectNetworkPrivate = OvhApiCloudProjectNetworkPrivate;\n    this.Subnet = OvhApiCloudProjectNetworkPrivateSubnet;\n    this.loaders = {\n      privateNetwork: {\n        query: false,\n        get: false\n      },\n      region: {\n        query: false\n      },\n      url: false,\n      save: false,\n      delete: false\n    };\n    this.urls = {\n      api: null\n    };\n    this.constraints = {\n      name: {\n        required: true,\n        trim: true,\n        maxlength: 256\n      },\n      vlanId: {\n        required: true,\n        min: 2,\n        max: 4000,\n        debounce: 50\n      },\n      subnet: {\n        address: {\n          required: true,\n          trim: true\n        },\n        mask: {\n          required: true,\n          min: 1,\n          max: 32,\n          trim: true\n        },\n        start: {\n          required: true,\n          trim: true\n        },\n        end: {\n          required: true,\n          trim: true\n        }\n      },\n      region: {\n        required: false\n      }\n    };\n    this.states = {\n      retries: 0\n    };\n  }\n\n  _createClass(CloudProjectComputeInfrastructurePrivateNetworkService, [{\n    key: \"fetchPrivateNetworks\",\n    value: function fetchPrivateNetworks(serviceName) {\n      var _this = this;\n\n      this.loaders.privateNetwork.query = true;\n      this.OvhApiCloudProjectNetworkPrivate.v6().resetCache();\n      return this.OvhApiCloudProjectNetworkPrivate.v6().query({\n        serviceName: serviceName\n      }).$promise.catch(function () {\n        return _this.CloudMessage.error(_this.$translate.instant('cpcipnd_fetch_private_networks_error'));\n      }).finally(function () {\n        _this.loaders.privateNetwork.query = false;\n      });\n    }\n  }, {\n    key: \"arePrivateNetworksLoading\",\n    value: function arePrivateNetworksLoading() {\n      return this.loaders.privateNetwork.query === true;\n    }\n  }, {\n    key: \"fetchPrivateNetwork\",\n    value: function fetchPrivateNetwork(serviceName, id) {\n      var _this2 = this;\n\n      this.loaders.privateNetwork.get = true;\n      this.OvhApiCloudProjectNetworkPrivate.v6().resetCache();\n      return this.OvhApiCloudProjectNetworkPrivate.v6().get({\n        serviceName: serviceName,\n        networkId: id\n      }).$promise.catch(function () {\n        return _this2.CloudMessage.error(_this2.$translate.instant('cpcipnd_fetch_private_network_error'));\n      }).finally(function () {\n        _this2.loaders.privateNetwork.get = false;\n      });\n    }\n  }, {\n    key: \"isPrivateNetworkLoading\",\n    value: function isPrivateNetworkLoading() {\n      return this.loaders.privateNetwork.get === true;\n    }\n  }, {\n    key: \"fetchRegions\",\n    value: function fetchRegions(serviceName) {\n      var _this3 = this;\n\n      this.loaders.region.query = true;\n      return this.Region.v6().query({\n        serviceName: serviceName\n      }).$promise.catch(function () {\n        return _this3.CloudMessage.error(_this3.$translate.instant('cpcipnd_fetch_regions_error'));\n      }).finally(function () {\n        _this3.loaders.region.query = false;\n      });\n    }\n  }, {\n    key: \"areRegionsLoading\",\n    value: function areRegionsLoading() {\n      return this.loaders.region.query === true;\n    }\n  }, {\n    key: \"fetchUrls\",\n    value: function fetchUrls() {\n      var _this4 = this;\n\n      this.loaders.url = true;\n      return this.User.v6().get().$promise.then(function (me) {\n        _this4.urls.api = _this4.URLS.guides.vlans[me.ovhSubsidiary].api;\n      }).catch(function () {\n        _this4.urls.api = _this4.URLS.guides.vlans.FR.api;\n      }).finally(function () {\n        _this4.loaders.url = false;\n      });\n    }\n  }, {\n    key: \"areUrlsLoading\",\n    value: function areUrlsLoading() {\n      return this.loaders.url === true;\n    }\n  }, {\n    key: \"getUrls\",\n    value: function getUrls() {\n      return this.urls;\n    }\n  }, {\n    key: \"savePrivateNetwork\",\n    value: function savePrivateNetwork(projectId, privateNetwork, onSuccess) {\n      var _this5 = this;\n\n      this.loaders.save = true;\n      return this.OvhApiCloudProjectNetworkPrivate.v6().save({\n        serviceName: projectId\n      }, privateNetwork).$promise.then(function (network) {\n        var options = {\n          serviceName: projectId,\n          privateNetworkId: network.id,\n          status: 'ACTIVE'\n        };\n        _this5.states.retries = 0;\n\n        _this5.pollPrivateNetworkStatus(options, function () {\n          _this5.loaders.save = false;\n          onSuccess(network, options);\n        }, function (error) {\n          _this5.loaders.save = false;\n\n          _this5.CloudMessage.error(_this5.$translate.instant('cpcipnd_poll_error', {\n            message: error.data.message || JSON.stringify(error)\n          }));\n        });\n      }).catch(function (error) {\n        _this5.CloudMessage.error(_this5.$translate.instant('cpcipnd_save_error', {\n          message: error.data.message || JSON.stringify(error)\n        }));\n\n        _this5.loaders.save = false;\n      });\n    }\n  }, {\n    key: \"pollPrivateNetworkStatus\",\n    value: function pollPrivateNetworkStatus(options, onSuccess, onFailure) {\n      var _this6 = this;\n\n      this.$timeout(function () {\n        if (_this6.isPrivateNetworkLoading()) {\n          return;\n        }\n\n        _this6.OvhApiCloudProjectNetworkPrivate.v6().resetCache();\n\n        _this6.fetchPrivateNetwork(options.serviceName, options.privateNetworkId).then(function (network) {\n          if (_this6.constructor.areAllRegionsActive(network)) {\n            onSuccess(network, options);\n          } else {\n            _this6.pollPrivateNetworkStatus(options, onSuccess, onFailure);\n          }\n        }).catch(function (error) {\n          return onFailure(error);\n        });\n      }, options.delay || 2000);\n    }\n  }, {\n    key: \"saveSubnet\",\n    value: function saveSubnet(projectId, networkId, subnet) {\n      var _this7 = this;\n\n      this.loaders.save = true;\n      return this.Subnet.v6().save({\n        serviceName: projectId,\n        networkId: networkId\n      }, subnet).$promise.catch(function (error) {\n        _this7.CloudMessage.error(_this7.$translate.instant('cpcipnd_save_error', {\n          message: error.data.message || JSON.stringify(error)\n        }));\n      }).finally(function () {\n        _this7.loaders.save = false;\n      });\n    }\n  }, {\n    key: \"isSavePending\",\n    value: function isSavePending() {\n      return this.loaders.save === true;\n    }\n  }, {\n    key: \"getConstraints\",\n    value: function getConstraints() {\n      return this.constraints;\n    }\n  }, {\n    key: \"deleteProjectNetworkPrivate\",\n    value: function deleteProjectNetworkPrivate(serviceName, networkId) {\n      var _this8 = this;\n\n      this.loaders.delete = true;\n      return this.OvhApiCloudProjectNetworkPrivate.v6().delete({\n        serviceName: serviceName,\n        networkId: networkId\n      }).$promise.catch(function (error) {\n        return _this8.$q.reject(error);\n      }).finally(function () {\n        _this8.loaders.delete = false;\n      });\n    }\n  }, {\n    key: \"isDeletePending\",\n    value: function isDeletePending() {\n      return this.loaders.delete === true;\n    }\n  }], [{\n    key: \"areAllRegionsActive\",\n    value: function areAllRegionsActive(network) {\n      return network.status === 'ACTIVE' && network.regions && _.every(network.regions, function (region) {\n        return region.status === 'ACTIVE';\n      });\n    }\n  }]);\n\n  return CloudProjectComputeInfrastructurePrivateNetworkService;\n}();\n\nangular.module('managerApp').service('CloudProjectComputeInfrastructurePrivateNetworkService', CloudProjectComputeInfrastructurePrivateNetworkService);",null]}